| Consumer (pact-mobile-app)                                                                                                                                                                                                                                                             | Provider (pact-order)                                                                                                                                                                                                                       | Pact Broker / Notes                                                                                                                                                                                                                                                                            |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------            | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -----------------------------------------------------------------------------------------------------------------------------------------------------------                                                                                                                                    |
| Write code in a feature branch.<br>Include a consumer Pact<br><br>`git checkout -b nd/my-new-feature`                                                                                                                                                                                  |                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                |
| Run consumer pact test:<br><br>`./gradlew clean test --tests "*ConsumerPactTest"`                                                                                                                                                                                                      |                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                |
| Publish the pact with branch=feature-branch-name and version=git-sha<br><br>`pact-broker publish build/pacts --consumer-app-version=$(git rev-parse HEAD) --branch=$(git rev-parse --abbrev-ref HEAD)`                                                                                 |                                                                                                                                                                                                                                             | Will show in pactflow matrix with branch name and version but unverified                                                                                                                                                                                                                       |
| Can I deploy to dev?<br><br>```pact-broker can-i-deploy --pacticipant=$(basename `git rev-parse --show-toplevel`) --version=$(git rev-parse HEAD) --to-environment=dev```                                                                                                                                              |                                                                                                                                                                                                                                             | <span style="color:red">Computer says no ¯\_(ツ)\_/¯</span><br><br>Reason: No provider                                                                                                                                                                                                          |
|                                                                                                                                                                                                                                                                                        | Write code in a feature branch.<br>Include a provider PACT<br><br>`git checkout -b nd/my-new-feature`                                                                                                                                       |                                                                                                                                                                                                                                                                                                |
|                                                                                                                                                                                                                                                                                        | Run the provider pact test:<br><br>`./gradlew test --tests "\*ProviderPactTest"`                                                                                                                                                            |                                                                                                                                                                                                                                                                                                |
|                                                                                                                                                                                                                                                                                        | Publish the results with branch=feature-branch-name and version=git-sha<br><br>`./gradlew -DpactPublishResults=true test --tests "\*ProviderPactTest"`                                                                                      | See [build.gradle](https://github.com/nathandeamer/pact-order/blob/6109fd115624357be206b07d4004b46e36504760/build.gradle#L62) where branch and version are set. <br><br>The pactflow matrix will now show that the pact has passed between these branches and versions. Notice no environment. |
| Can I deploy to dev?<br><br>```pact-broker can-i-deploy --pacticipant=$(basename `git rev-parse --show-toplevel`) --version=$(git rev-parse HEAD) --to-environment=dev```                                                                                                                                              |                                                                                                                                                                                                                                             | <span style="color:red">Computer says no ¯\_(ツ)\_/¯</span><br><br>Reason: Provider hasn't been deployed to dev yet.                                                                                                                                                                            |
|                                                                                                                                                                                                                                                                                        | Can I deploy to dev?<br><br>```pact-broker can-i-deploy --pacticipant=$(basename `git rev-parse --show-toplevel`) --version=$(git rev-parse HEAD) --to-environment=dev```                                                                                                        | <span style="color:green">All required verification results are published and successful</span>                                                                                                                                                                                                |
|                                                                                                                                                                                                                                                                                        | PR is merged to main and provider is deployed to dev.<br>Provider tests are ran again and results published:<br>branch=main<br>version=git-sha<br><br>`./gradlew -DpactPublishResults=true test --tests "\*ProviderPactTest"`               | The pactflow matrix will now show that the consumer feature branch is compatible with provider main branch.                                                                                                                                                                                    |
|                                                                                                                                                                                                                                                                                        | Once provider has been deployed to dev we need to record a deployment:<br><br>```pact-broker record-deployment --pacticipant=$(basename `git rev-parse --show-toplevel`) --version=$(git rev-parse HEAD) --environment=dev```                                                    | The pactflow matrix will now show that provider main has been deployed to the development environment                                                                                                                                                                                          |
| Can I deploy to dev?<br><br>```pact-broker can-i-deploy --pacticipant=$(basename `git rev-parse --show-toplevel`) --version=$(git rev-parse HEAD) --to-environment=dev```                                                                                                                                             |                                                                                                                                                                                                                                             | <span style="color:green">All required verification results are published and successful</span>                                                                                                                                                                                                |
| PR is merged to main and consumer is deployed to dev.<br><br>Consumer tests are ran again and published to pact with branch=main and version=git-sha<br><br>`pact-broker publish build/pacts --consumer-app-version=$(git rev-parse HEAD) --branch=$(git rev-parse --abbrev-ref HEAD)` |                                                                                                                                                                                                                                             | The pactflow matrix will now show that the consumer and provider main branches are compatible                                                                                                                                                                                                  |
| Once consumer has been deployed to dev we need to record a deployment:<br><br>```pact-broker record-deployment --pacticipant=$(basename `git rev-parse --show-toplevel`) --version=$(git rev-parse HEAD) --environment=dev```                                                                                          |                                                                                                                                                                                                                                             | The pactflow matrix will now show that the consumer and provider have both been deployed to dev.                                                                                                                                                                                               |
|                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                |
| **Staging:**                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                |
| Can I deploy to staging?<br><br>```pact-broker can-i-deploy --pacticipant=$(basename `git rev-parse --show-toplevel`) --version=$(git rev-parse HEAD) --to-environment=staging```                                                                                                                                      |                                                                                                                                                                                                                                             | <span style="color:red">Computer says no ¯\_(ツ)\_/¯</span>.<br><br>Reason: The provider build hasn't been deployed to staging yet.                                                                                                                                                             |
|                                                                                                                                                                                                                                                                                        | Can I deploy to staging?<br><br>```pact-broker can-i-deploy ---pacticipant=$(basename `git rev-parse --show-toplevel`)--version=$(git rev-parse HEAD) --to-environment=staging```                                                                                                | <span style="color:green">All required verification results are published and successful</span>                                                                                                                                                                                                |
|                                                                                                                                                                                                                                                                                        | Once provider has been deployed to staging we need to record a deployment:<br><br>```pact-broker record-deployment --pacticipant=$(basename `git rev-parse --show-toplevel`) --version=$(git rev-parse HEAD) --environment=staging```                                            | We don't need to run the provider tests again as we are deploying the exact same build from dev to staging. So we just need to record a deployment. <br><br>The pactflow matrix will now show that the provider has been deployed to staging.                                                  |
| Can I deploy to staging?<br><br>```pact-broker can-i-deploy --pacticipant=$(basename `git rev-parse --show-toplevel`) --version=$(git rev-parse HEAD) --to-environment=staging```                                                                                                                                      |                                                                                                                                                                                                                                             | <span style="color:green">All required verification results are published and successful</span>                                                                                                                                                                                                |
| Once consumer has been deployed to staging we need to record a deployment:<br><br>```pact-broker record-deployment --pacticipant=$(basename `git rev-parse --show-toplevel`) --version=$(git rev-parse HEAD) --environment=staging```                                                                                  |                                                                                                                                                                                                                                             | We don't need to run the consumer tests again as we are deploying the exact same build from dev to staging. So we just need to record a deployment. <br><br>The pactflow matrix will now show that the consumer and provider have both been deployed to staging.                               |
|                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                |
| **Production**
| Can I deploy to production?<br><br>```pact-broker can-i-deploy --pacticipant=$(basename `git rev-parse --show-toplevel`) --version=$(git rev-parse HEAD) --to-environment=prod```                                                     |                                                                                                                                                                                                  | <span style="color:red">Computer says no ¯\_(ツ)\_/¯</span>.<br><br>Reason: The provider build hasn't been deployed to production yet.                                                                                                                                        |
|                                                                                                                                                                                                       | Can I deploy to production?<br><br>```pact-broker can-i-deploy --pacticipant=$(basename `git rev-parse --show-toplevel`) --version=$(git rev-parse HEAD) --to-environment=production```                                               | <span style="color:green">All required verification results are published and successful</span>                                                                                                                                                                              |
|                                                                                                                                                                                                       | Once provider has been deployed to production we need to record a deployment:<br><br>```pact-broker record-deployment --pacticipant=$(basename `git rev-parse --show-toplevel`) --version=$(git rev-parse HEAD) --environment=prod``` | We don't need to run the provider tests again as we are deploying the exact same build from staging to prod. So we just need to record a deployment. <br><br>The pactflow matrix will now show that the provider has been deployed to production.                            |
|                                                                                                                                                                                                       | Once provider has been deployed to production we need to record a release:<br><br>```pact-broker record-release --pacticipant=$(basename `git rev-parse --show-toplevel`) --version=$(git rev-parse HEAD) --environment=prod```       | You should only record a release when the code is on a production environment.<br>This will show in pactflow under 'release environments'                                                                                                                                    |
| Can I deploy to production?<br><br>```pact-broker can-i-deploy --pacticipant=$(basename `git rev-parse --show-toplevel`) --version=$(git rev-parse HEAD) --to-environment=prod```                                                     |                                                                                                                                                                                                  | <span style="color:green">All required verification results are published and successful</span>                                                                                                                                                                              |
| Once consumer has been deployed to production we need to record a deployment:<br><br>```pact-broker record-deployment --pacticipant=$(basename `git rev-parse --show-toplevel`) --version=$(git rev-parse HEAD) --environment=prod``` |                                                                                                                                                                                                  | We don't need to run the production tests again as we are deploying the exact same build from staging to production. So we just need to record a deployment. <br><br>The pactflow matrix will now show that the consumer and provider have both been deployed to production. |
| Once consumer has been deployed to production we need to record a release:<br><br>```pact-broker record-release --pacticipant=$(basename `git rev-parse --show-toplevel`) --version=$(git rev-parse HEAD) --environment=prod```       |                                                                                                                                                                                                  | You should only record a release when the code is on a production environment.<br>This will show in pactflow under 'release environments'                                                                                                                                    |

